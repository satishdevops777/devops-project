# RoboShop ‚Äì User Microservice Setup

This document explains how to install, configure, and run the **User microservice** of the RoboShop e‚Äëcommerce application. It is written in **GitHub‚Äëready README.md format** with clear explanations suitable for **DevOps / SRE learning and real production understanding**.

---

## üìå What is the User Service?

The **User** service is a backend microservice responsible for:

* User **registration**
* User **login / authentication**
* Managing user-related data

It acts as a critical component for authentication flows in the RoboShop application.

---

## üß± Technology Stack

| Component       | Technology                  |
| --------------- | --------------------------- |
| Language        | NodeJS (> 18)               |
| Databases       | MongoDB, Redis              |
| Service Manager | systemd                     |
| OS              | RHEL / CentOS / Rocky Linux |

---

## ‚ö†Ô∏è Important Notes

* The application is **custom-built** (not available as an RPM)
* All steps must be configured **manually**
* The service must run as a **non-root user**
* MongoDB and Redis are **external dependencies**

---

## 1Ô∏è‚É£ Install NodeJS 18

### Why?

The developer has confirmed that the User service is compatible with **NodeJS version 18 or higher**. Older versions are unsupported and insecure.

---

### List available NodeJS modules

```bash
dnf module list nodejs
```

---

### Disable default NodeJS module

```bash
dnf module disable nodejs -y
```

---

### Enable NodeJS 18 module

```bash
dnf module enable nodejs:18 -y
```

---

### Install NodeJS

```bash
dnf install nodejs -y
```

---

### Verify installation

```bash
node -v
```

Expected output:

```text
v18.x.x
```

---

## 2Ô∏è‚É£ Create Application User

### Why?

Running applications as **root is a security risk**. A dedicated daemon user ensures better isolation.

```bash
useradd roboshop
```

> ‚ÑπÔ∏è `roboshop` is a system user used only to run RoboShop services.

---

## 3Ô∏è‚É£ Create Application Directory

```bash
mkdir /app
```

### Why `/app`?

Using a standard directory makes automation, monitoring, and troubleshooting easier.

---

## 4Ô∏è‚É£ Download User Service Code

```bash
curl -L -o /tmp/user.zip https://roboshop-artifacts.s3.amazonaws.com/user.zip
```

Extract application code:

```bash
cd /app
unzip /tmp/user.zip
```

This creates the NodeJS project structure including:

* `server.js`
* `package.json`

---

## 5Ô∏è‚É£ Install Application Dependencies

```bash
cd /app
npm install
```

### What this does

* Reads `package.json`
* Downloads required NodeJS libraries
* Creates `node_modules/`

---

## 6Ô∏è‚É£ Configure systemd Service

### Why systemd?

Using systemd provides:

* Service auto-start on reboot
* Crash recovery
* Centralized logging

---

### Create service file

```bash
vim /etc/systemd/system/user.service
```

---

### User service definition

```ini
[Unit]
Description=User Service

[Service]
User=roboshop
Environment=MONGO=true
Environment=REDIS_HOST=<REDIS-SERVER-IP>
Environment=MONGO_URL="mongodb://<MONGODB-SERVER-IP-ADDRESS>:27017/users"
ExecStart=/bin/node /app/server.js
SyslogIdentifier=user

[Install]
WantedBy=multi-user.target
```

> ‚ö†Ô∏è Replace `<REDIS-SERVER-IP>` and `<MONGODB-SERVER-IP-ADDRESS>` with actual IP addresses.

---

## 7Ô∏è‚É£ Load and Start the Service

### Reload systemd

```bash
systemctl daemon-reload
```

---

### Enable service at boot

```bash
systemctl enable user
```

---

### Start service

```bash
systemctl start user
```

---

### Verify service status

```bash
systemctl status user
```

Expected state:

```text
active (running)
```

---

## üîÅ User Service Request Flow

```text
Browser
 ‚Üí Nginx Frontend
 ‚Üí /api/user
 ‚Üí User NodeJS Service
 ‚Üí MongoDB (user data)
 ‚Üí Redis (session / cache)
 ‚Üí Response to browser
```

---

## üö® Common Issues & Fixes

| Issue                    | Cause                | Fix                         |
| ------------------------ | -------------------- | --------------------------- |
| Service fails to start   | Wrong NodeJS version | Install NodeJS 18           |
| MongoDB connection error | Wrong IP / port      | Verify MongoDB URL          |
| Redis connection error   | Redis not reachable  | Check Redis bind & firewall |
| Permission denied        | Wrong user           | Ensure `User=roboshop`      |

---

## ‚úÖ Final Checklist

* [x] NodeJS 18 installed
* [x] roboshop user created
* [x] Application code deployed
* [x] Dependencies installed
* [x] systemd service configured
* [x] MongoDB connectivity verified
* [x] Redis connectivity verified

---


üöÄ **User microservice setup is complete and ready for integration.**
