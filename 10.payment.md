# RoboShop ‚Äì Payment Microservice Setup

This document explains how to install, configure, and run the **Payment microservice** of the RoboShop e-commerce application. It is written in **GitHub-ready README.md format**, following **real-world DevOps / SRE practices**.

---

## üìå What is the Payment Service?

The **Payment** service is responsible for:

* Processing user payments
* Communicating with Cart and User services
* Publishing payment events to RabbitMQ

It is a **critical backend service** in the RoboShop checkout flow.

---

## üß± Technology Stack

| Component       | Technology                  |
| --------------- | --------------------------- |
| Language        | Python 3.6                  |
| App Server      | uWSGI                       |
| Messaging       | RabbitMQ                    |
| Dependencies    | Cart, User services         |
| Service Manager | systemd                     |
| OS              | RHEL / CentOS / Rocky Linux |

---

## ‚ö†Ô∏è Important Notes

* The Payment service is a **custom-built Python application**
* It is **not available as an RPM**
* All setup steps are done **manually**
* Python version **must match developer requirements (3.6)**

---

## 1Ô∏è‚É£ Install Python 3.6 and Build Tools

### Why these packages?

* `python36` ‚Üí Required runtime
* `gcc` & `python3-devel` ‚Üí Needed to compile Python dependencies

---

### Install required packages

```bash
dnf install python36 gcc python3-devel -y
```

### Verify Python version

```bash
python3.6 --version
```

Expected output:

```text
Python 3.6.x
```

---

## 2Ô∏è‚É£ Create Application User

### Why?

Running applications as **root is insecure**. A dedicated daemon user is recommended.

```bash
useradd roboshop
```

> ‚ÑπÔ∏è `roboshop` is a system user used only to run RoboShop services.

> ‚ö†Ô∏è Note: The provided systemd file runs as `root` due to uWSGI requirements in this lab. In production, this should be changed to a non-root user.

---

## 3Ô∏è‚É£ Create Application Directory

```bash
mkdir /app
```

### Why `/app`?

Using a standard directory simplifies automation, monitoring, and troubleshooting.

---

## 4Ô∏è‚É£ Download Payment Service Code

```bash
curl -L -o /tmp/payment.zip https://roboshop-artifacts.s3.amazonaws.com/payment.zip
```

Extract application code:

```bash
cd /app
unzip /tmp/payment.zip
```

This creates the Python project structure including:

* `payment.ini`
* `requirements.txt`
* Application source files

---

## 5Ô∏è‚É£ Install Python Dependencies

### Why?

Python applications depend on external libraries listed in `requirements.txt`.

```bash
cd /app
pip3.6 install -r requirements.txt
```

This installs all required Python packages.

---

## 6Ô∏è‚É£ Configure systemd Service

### Why systemd?

Using systemd provides:

* Automatic startup on reboot
* Process supervision
* Centralized logging

---

### Create service file

```bash
vim /etc/systemd/system/payment.service
```

---

### Payment service definition

```ini
[Unit]
Description=Payment Service

[Service]
User=root
WorkingDirectory=/app
Environment=CART_HOST=<CART-SERVER-IPADDRESS>
Environment=CART_PORT=8080
Environment=USER_HOST=<USER-SERVER-IPADDRESS>
Environment=USER_PORT=8080
Environment=AMQP_HOST=<RABBITMQ-SERVER-IPADDRESS>
Environment=AMQP_USER=roboshop
Environment=AMQP_PASS=roboshop123

ExecStart=/usr/local/bin/uwsgi --ini payment.ini
ExecStop=/bin/kill -9 $MAINPID
SyslogIdentifier=payment

[Install]
WantedBy=multi-user.target
```

> ‚ö†Ô∏è Replace placeholders with actual server IP addresses.

---

## 7Ô∏è‚É£ Load and Start the Service

### Reload systemd

```bash
systemctl daemon-reload
```

---

### Enable service at boot

```bash
systemctl enable payment
```

---

### Start service

```bash
systemctl start payment
```

---

### Verify service status

```bash
systemctl status payment
```

Expected state:

```text
active (running)
```

---

## üîÅ Payment Service Request Flow

```text
Browser
 ‚Üí Nginx Frontend
 ‚Üí /api/payment
 ‚Üí Payment Python Service
 ‚Üí Cart Service
 ‚Üí User Service
 ‚Üí RabbitMQ
 ‚Üí Payment Confirmation
```

---

## üö® Common Issues & Fixes

| Issue                    | Cause                   | Fix                   |
| ------------------------ | ----------------------- | --------------------- |
| Service not starting     | Python version mismatch | Install Python 3.6    |
| Dependency install fails | Missing gcc/devel       | Install build tools   |
| RabbitMQ auth failure    | Wrong credentials       | Verify AMQP user/pass |
| Cart/User unreachable    | Wrong IP/port           | Check env variables   |

---

## ‚úÖ Final Checklist

* [x] Python 3.6 installed
* [x] Application code deployed
* [x] Dependencies installed
* [x] systemd service configured
* [x] RabbitMQ connectivity verified
* [x] Cart & User services reachable

---


üöÄ **Payment microservice setup is complete and ready for end-to-end checkout flow.**
